<!DOCTYPE html>
<html dir="ltr" lang="ja">

  <head>
    <title>Profiler - Rubinius</title>
  	<meta charset="UTF-8">
  	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <meta content='ja' http-equiv='content-language'>
    <meta content='Rubinius is an implementation of the Ruby programming language. The Rubinius bytecode virtual machine is written in C++. The bytecode compiler is written in pure Ruby. The vast majority of the core library is also written in Ruby, with some supporting primitives that interact with the VM directly.' name='description'>
    <link href='/' rel='home'>
    <link href='/' rel='start'>
    <link href='/doc/ja/tools/debugger' rel='prev' title='Debugger'>
    <link href='/doc/ja/tools/memory-analysis'         rel='next' title='Memory Analysis'>
    
    <!--[if IE]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script><![endif]-->
    <script src="/javascripts/jquery-1.3.2.js"></script>
    <script src="/javascripts/paging_keys.js"></script>
    
    <script src="/javascripts/application.js"></script>
    <style>article, aside, dialog, figure, footer, header, hgroup, menu, nav, section { display: block; }</style>

    <link href="/stylesheets/blueprint/screen.css" media="screen" rel="stylesheet" />
    <link href="/stylesheets/application.css"      media="screen" rel="stylesheet" />
    <link href="/stylesheets/blueprint/print.css"  media="print"  rel="stylesheet" />
    <!--[if IE]><link href="/stylesheets/blueprint/ie.css" media="screen" rel="stylesheet" type="text/css" /><![endif]-->
    <!--[if IE]><link href="/stylesheets/ie.css"           media="screen" rel="stylesheet" type="text/css" /><![endif]-->
    <link href="/stylesheets/pygments.css" media="screen" rel="stylesheet" />

    <link href="/favicon.ico"                 rel="shortcut icon"    type="image/vnd.microsoft.icon" />
    <link href="/images/apple-touch-icon.png" rel="apple-touch-icon" type="image/png" />
    <link href="/images/apple-touch-icon.png" rel="apple-touch-icon" type="image/png" sizes="72x72"   />
    <link href="/images/apple-touch-icon.png" rel="apple-touch-icon" type="image/png" sizes="114x114" />
  </head>

  <body>
    <div class='container'>
  <div class='span-21 doc_menu'>
    <header>
      <nav>
  <ul>
    <li><a href="/">Home</a></li>
    <li><a id="blog" href="/blog">Blog</a></li>
    <li><a id="documentation" href="/doc/en">Documentation</a></li>
    <li><a href="/projects">Projects</a></li>
    <li><a href="/roadmap">Roadmap</a></li>
    <li><a href="/releases">Releases</a></li>
  </ul>
</nav>

    </header>
  </div>
  <div class='span-3 last'>
  <div id='version'>
    <a href="/releases/1.2.4">1.2.4</a>
  </div>
</div>

</div>


<div class="container languages">
  <nav>
  <span class="label">言語:</span>
  <ul>
    
    
    
    <li><a href="/doc/de/tools/profiler/"
      
      >de</a></li>
    
    
    
    <li><a href="/doc/en/tools/profiler/"
      
      >en</a></li>
    
    
    
    <li><a href="/doc/es/tools/profiler/"
      
      >es</a></li>
    
    
    
    <li><a href="/doc/fr/tools/profiler/"
      
      >fr</a></li>
    
    
    
    <li><a href="/doc/ja/tools/profiler/"
      
      class="current"
      
      >ja</a></li>
    
    
    
    <li><a href="/doc/pl/tools/profiler/"
      
      >pl</a></li>
    
    
    
    <li><a href="/doc/pt-br/tools/profiler/"
      
      >pt-br</a></li>
    
    
    
    <li><a href="/doc/ru/tools/profiler/"
      
      >ru</a></li>
    
  </ul>
  </nav>
</div>


<div class="container doc_page_nav">
  
    
    <span class="label">Previous:</span>
    <a href="/doc/ja/tools/debugger">Debugger</a>
    

    <span class="label">Up:</span>
    <a href="/doc/ja/">目次</a>

    
    <span class="label">Next:</span>
    <a href="/doc/ja/tools/memory-analysis">Memory Analysis</a>
    
  
</div>


<div class="container documentation">
  <h2>Profiler</h2>

  
    <div class="review">
  <p>This page was machine translated. Please help us improve it.</p>

  <p>
    See <a href="/doc/ja/how-to/translate-documentation">How-To - Translate Documentation</a>
  </p>
</div>

  

  

    <p>Rubiniusはすべての正確なタイミングを提供していますインストルメントプロファイラを持って
メソッドは、その実行されます。プロファイラは、VMレベルのデータで実装されています
プロセスにRubyのコードに提供されています。</p>

<h2 id="vm">VMのプロファイラは、</h2>

<p>作成および維持するプロファイラに携わった文字のキャスト
VMは、SharedState、ProfilerCollectionと、プロファイラが含まれています。 VMのクラスは
スレッドローカルデータ構造。各VMのインスタンスは、個別のプロファイラを取得
インスタンスを作成します。 SharedStateインスタンスは、そのマップProfilerCollectionのインスタンスを持つ
プロファイラにVMは、すべてのプロファイラの複合結果を生成します。</p>

<p>プロファイラが住んでおり、独自の世界で死ぬ。プロファイラは、VMを渡される
プロファイラは、それへのアクセスを必要とするため、それが作成されるインスタンス時間
情報を収集しています。国の引数は、すべてのプロファイラに渡すことができます
メソッドが、それは十分なプロファイラが作成されたときにそれを渡すことは簡単です。
プロファイラは決してVMインスタンスを操作します。これは、維持することが重要です
この分離。</p>

<p>VMのインスタンスは、遅延、必要に応じて、そのプロファイラのインスタンスが作成されます。 VMの
SharedStateとプロファイラを登録します。</p>

<p>SharedStateはProfilerCollectionのインスタンスを保持転送コール
登録したり、プロファイラを削除してください。</p>

<p>VMインスタンスにマップされたProfilerCollectionインスタンスを要求
プロファイラは、プロファイラは削除されますプロファイラを削除します。</p>

<h2 id="ruby">Rubyのプロファイラを</h2>

<p>Rubyの土地では、Rubiniusは：：プロファイラ：：計測機能のインスタンスが何を公開
VMでマルチスレッドの現実について。個々のC + +のプロファイラ
インスタンスは、Rubyには公開されません。 Rubyでは、プロファイラのインスタンスが作成されます。
そのインスタンスは、単に起動することができますおよびVMプロファイラを停止します。ときにプロファイラは、
停止すると、プロファイリングに関する情報は、LookupTableのが返されます。ルビー
プロファイラコードは、情報が＃showメソッドを使用して表示することができます。</p>

<p>Rubiniusは互換性のある標準ライブラリprofile.rbとprofiler.rbを提供しています。
参照してくださいMRIにそれらを使用する方法についてはマニュアルを参照してください</p>

<p>あなたはプロファイラを使用するための基本的な手順を参照してください<code>lib/profiler.rb</code>のですることができますみる
Rubyのコードから。</p>

<pre><code># create a profiler instance
profiler = Rubinius::Profiler::Instrumenter.new

# start the profiler
profiler.start

# stop the profiler
profiler.stop

# get the profile data
data = profiler.info

# or print out the profiler info
profiler.show  # takes on IO object, defaults to STDOUT
</code></pre>

<p>また、ブロック内の作業をプロファイリングするための便利なメソッドを使用することができます。</p>

<pre><code># create a profiler instance
profiler = Rubinius::Profiler::Instrumenter.new

# profile some work
profiler.profile do
  # some work
end
</code></pre>

<p>#profileはメソッドは、プロファイラを、利回り起動し、プロファイラを停止し、出力
デフォルトではプロファイルデータ。パスは、&rsquo;false&rsquo;にデータを印刷しないように#profileする。
どちらにしても、プロファイルデータ自体は#profileによって返されます。</p>

<h2 id="how-to-read-the-flat-profiler-output">How to Read the Flat Profiler Output</h2>

<p>The flat profiler output has the following columns:</p>

<h3 id="time">% time</h3>

<p>The amount of time spent in this method as a percentage of the total time
spent in all methods.</p>

<h3 id="cumulative-seconds">cumulative seconds</h3>

<p>The total amount of time spent in this method and all its direct callees and
their callees all the way to every leaf method called along a path from this
method. Consider this method as the root of a call tree. The sum of all the
time spent in methods in this call tree is the cumulative seconds for this
method.</p>

<h3 id="self-seconds">self seconds</h3>

<p>The total time spent in this method less the total time spent in all this
method&rsquo;s callees.</p>

<h3 id="calls">calls</h3>

<p>The total number of times this method was called.</p>

<h3 id="self-mscall">self ms/call</h3>

<p>The self seconds as milliseconds divided by the total number of calls.</p>

<h3 id="total-mscall">total ms/call</h3>

<p>The cumulative seconds as milliseconds divided by the total number of calls.</p>

<h3 id="example-of-flat-output">Example of Flat Output</h3>

<p>The following script is the basis of both profile examples below.</p>

<pre><code>class F
  def foo(a)
    1 + a
  end

  def bar(a, b)
    foo(a) ** b
  end

  def work(a, b, n, m)
    n.times { |i| i + bar(a, b) }
    m.times { |i| foo(i) }
  end
end

p = Rubinius::Profiler::Instrumenter.new :sort =&gt; :self_seconds
p.profile {
  F.new.work 2, 3, 10, 5
}
</code></pre>

<p>Running the script with &lsquo;bin/rbx script.rb&rsquo; should give the following flat
output.</p>

<pre><code>  %   cumulative   self                self     total
 time   seconds   seconds      calls  ms/call  ms/call  name
------------------------------------------------------------
  9.64     0.00      0.00         10     0.00     0.00  Fixnum#**
 23.33     0.00      0.00          1     0.01     0.08  #toplevel
 12.64     0.00      0.00         10     0.00     0.00  F#bar
 15.38     0.00      0.00         15     0.00     0.00  F#work {}
 17.74     0.00      0.00          2     0.00     0.03  Integer#times
 19.29     0.00      0.00          1     0.01     0.06  F#work
  1.12     0.00      0.00          1     0.00     0.00  Class#new
  0.68     0.00      0.00         15     0.00     0.00  F#foo
  0.13     0.00      0.00          1     0.00     0.00  Class#allocate
  0.06     0.00      0.00          1     0.00     0.00  Object#initialize

10 methods called a total of 57 times
</code></pre>

<h2 id="how-to-read-the-graph-output">How to Read the Graph Output</h2>

<p>The graph output is enabled with the configuration option:</p>

<pre><code>-Xprofiler.graph
</code></pre>

<p>Given the same script above, the graph output is shown below. Each &ldquo;entry&rdquo; in
the graph has three sections: 1) the method for the entry, called the
<em>primary</em> line; 2) the callers of the primary method; and 3) the methods that
the primary method called. The fields have different meanings based on the
part of the entry.</p>

<p>For the primary line, the fields are as follows:</p>

<h3 id="index">index</h3>

<p>An index assigned to each method in the graph to facilitate cross-referencing
the entries.</p>

<h3 id="time-1">% time</h3>

<p>The amount of time spent in this method as a percentage of the total time
spent in all methods. This is the same as the flat output.</p>

<h3 id="self">self</h3>

<p>The total time spent in this method less the total time spent in all this
method&rsquo;s callees. This is the same as self seconds in the flat output.</p>

<h3 id="children">children</h3>

<p>The total time spent in all the methods called by this method.</p>

<h3 id="called">called</h3>

<p>The total number of times this method was called.</p>

<h3 id="name">name</h3>

<p>The name of the method followed by the index number.</p>

<p>The lines above the primary line are methods that call the primary method. The
callers&rsquo; fields have the following interpretation:</p>

<h3 id="self-1">self</h3>

<p>The total time spent in this method less the total time spent in all this
method&rsquo;s callees. This is the same as self seconds in the flat output.</p>

<h3 id="children-1">children</h3>

<p>The time spent in the method&rsquo;s call to the primary method.</p>

<h3 id="called-1">called</h3>

<p>The called field has two parts separated by a forward slash. The left is the
number of times this method called the primary method. The right is the total
number of calls this method made. In other words, the two numbers together
show a ratio of the calls to the primary method versus all calls made by the
caller.</p>

<h3 id="name-1">name</h3>

<p>The name of the caller followed by its index number. If the index is [0], the
method does not appear in the graph.</p>

<p>The lines below the primary line are methods that the primary method called.
The fields for the called methods are as follows:</p>

<h3 id="self-2">self</h3>

<p>The total time spent in this method less the total time spent in all this
method&rsquo;s callees. This is the same as self seconds in the flat output.</p>

<h3 id="children-2">children</h3>

<p>This is an estimate of the amount of time this method&rsquo;s callees spent when
this method was called by the primary method. The estimate is based on the
ration of the time this method spent when called by the primary method to the
total time spent in this method.</p>

<h3 id="called-2">called</h3>

<p>The called field has two parts separated by a forward slash. The left is the
number of times this method was called by the primary method. The right is the
total number of times this method was called.</p>

<h3 id="name-2">name</h3>

<p>The name of the called method followed by its index number [N]. If there is no
index present, there is no primary entry for the method in the graph. Use the
-Xprofiler.full_report option to print the entire graph if you need to view
the entry.</p>

<pre><code>index  % time     self  children         called       name
----------------------------------------------------------
                  0.00      0.00         10/20             F#bar [3]
[1]       9.6     0.00      0.00         10           Fixnum#** [1]
-------------------------------------------------------
[2]      23.2     0.00      0.00          1           #toplevel [2]
                  0.00      0.00          1/1              Class#new [7]
                  0.00      0.00          1/1              F#work [6]
-------------------------------------------------------
                  0.00      0.00         10/15             F#work {} [4]
[3]      12.7     0.00      0.00         10           F#bar [3]
                  0.00      0.00         10/15             F#foo [8]
                  0.00      0.00         10/10             Fixnum#** [1]
-------------------------------------------------------
                  0.00      0.00         15/15             Integer#times [5]
[4]      15.4     0.00      0.00         15           F#work {} [4]
                  0.00      0.00         10/10             F#bar [3]
                  0.00      0.00          5/15             F#foo [8]
-------------------------------------------------------
                  0.00      0.00          2/2              F#work [6]
[5]      17.8     0.00      0.00          2           Integer#times [5]
                  0.00      0.00         15/15             F#work {} [4]
-------------------------------------------------------
                  0.00      0.00          1/2              #toplevel [2]
[6]      19.3     0.00      0.00          1           F#work [6]
                  0.00      0.00          2/2              Integer#times [5]
-------------------------------------------------------
                  0.00      0.00          1/2              #toplevel [2]
[7]       1.1     0.00      0.00          1           Class#new [7]
                  0.00      0.00          1/1              Object#initialize [10]
                  0.00      0.00          1/1              Class#allocate [9]
-------------------------------------------------------
                  0.00      0.00         10/20             F#bar [3]
                  0.00      0.00          5/15             F#work {} [4]
[8]       0.7     0.00      0.00         15           F#foo [8]
-------------------------------------------------------
                  0.00      0.00          1/2              Class#new [7]
[9]       0.1     0.00      0.00          1           Class#allocate [9]
-------------------------------------------------------
                  0.00      0.00          1/2              Class#new [7]
[10]      0.1     0.00      0.00          1           Object#initialize [10]
-------------------------------------------------------

10 methods called a total of 57 times
</code></pre>



</div>

<div class="container doc_page_nav">
  
    
    <span class="label">Previous:</span>
    <a href="/doc/ja/tools/debugger">Debugger</a>
    

    <span class="label">Up:</span>
    <a href="/doc/ja/">目次</a>

    
    <span class="label">Next:</span>
    <a href="/doc/ja/tools/memory-analysis">Memory Analysis</a>
    
  
</div>


<div class="container">
  <div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname  = 'rubinius';
  var disqus_identifier = '/doc/ja/tools/profiler/';
  var disqus_url = 'http://rubini.us/doc/ja/tools/profiler/';

  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

</div>

<footer>
  <div class='container'>
    <nav>
      <ul>
        <li><a rel="external" href="http://twitter.com/rubinius">Follow Rubinius on Twitter</a></li>
        <li><a rel="external" href="http://github.com/rubinius/rubinius">Fork Rubinius on github</a></li>
        <li><a rel="external" href="http://engineyard.com">An Engine Yard project</a></li>
      </ul>
    </nav>
  </div>
</footer>

<script>
  var _gaq=[['_setAccount','UA-12328521-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>


  </body>
</html>
